/**
 *  Exponential Backoff Retries
 */
export class BackoffRetry {
    /**
     * @param min  Initial retry delay
     * @param max  Max retry delay
     * @param k    Increase factor
     */
    constructor(min = 200, max = min * 300, k = 2) {
        this.min = min;
        this.max = max;
        this.k = k;
        this.code = -1;
        this.retryAttempts = 1;
        this.delay = this.min;
    }
    /**
     * Delay Retry
     * @param code
     * @returns retryAttempts
     */
    wait(code) {
        return new Promise(resolve => {
            if (code === this.code) {
                this.retryAttempts++;
                this.delay = Math.min(this.delay * this.k, this.max);
            }
            else {
                this.delay = this.min;
                this.retryAttempts = 1;
            }
            this.code = code;
            setTimeout(() => resolve(this.retryAttempts), this.delay + Math.floor(Math.random() * this.min));
        });
    }
    /**
     * Reset Retry
     */
    reset() {
        this.delay = this.min;
        this.retryAttempts = 1;
        this.code = -1;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja29mZl9yZXRyeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC11cGxvYWR4LyIsInNvdXJjZXMiOlsiYmFja29mZl9yZXRyeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7R0FFRztBQUNILE1BQU0sT0FBTyxZQUFZO0lBSXZCOzs7O09BSUc7SUFDSCxZQUFvQixNQUFNLEdBQUcsRUFBVSxNQUFNLEdBQUcsR0FBRyxHQUFHLEVBQVUsSUFBSSxDQUFDO1FBQWpELFFBQUcsR0FBSCxHQUFHLENBQU07UUFBVSxRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQVUsTUFBQyxHQUFELENBQUMsQ0FBSTtRQVA3RCxTQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDbEIsa0JBQWEsR0FBRyxDQUFDLENBQUM7UUFPaEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ3hCLENBQUM7SUFDRDs7OztPQUlHO0lBQ0gsSUFBSSxDQUFDLElBQWE7UUFDaEIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMzQixJQUFJLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxFQUFFO2dCQUN0QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQ3JCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3REO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQztnQkFDdEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUM7YUFDeEI7WUFDRCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUNqQixVQUFVLENBQ1IsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsRUFDakMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQ2xELENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDRDs7T0FFRztJQUNILEtBQUs7UUFDSCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7UUFDdEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUM7UUFDdkIsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNqQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBFeHBvbmVudGlhbCBCYWNrb2ZmIFJldHJpZXNcbiAqL1xuZXhwb3J0IGNsYXNzIEJhY2tvZmZSZXRyeSB7XG4gIHByaXZhdGUgZGVsYXk6IG51bWJlcjtcbiAgcHJpdmF0ZSBjb2RlID0gLTE7XG4gIHJldHJ5QXR0ZW1wdHMgPSAxO1xuICAvKipcbiAgICogQHBhcmFtIG1pbiAgSW5pdGlhbCByZXRyeSBkZWxheVxuICAgKiBAcGFyYW0gbWF4ICBNYXggcmV0cnkgZGVsYXlcbiAgICogQHBhcmFtIGsgICAgSW5jcmVhc2UgZmFjdG9yXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIG1pbiA9IDIwMCwgcHJpdmF0ZSBtYXggPSBtaW4gKiAzMDAsIHByaXZhdGUgayA9IDIpIHtcbiAgICB0aGlzLmRlbGF5ID0gdGhpcy5taW47XG4gIH1cbiAgLyoqXG4gICAqIERlbGF5IFJldHJ5XG4gICAqIEBwYXJhbSBjb2RlXG4gICAqIEByZXR1cm5zIHJldHJ5QXR0ZW1wdHNcbiAgICovXG4gIHdhaXQoY29kZT86IG51bWJlcik6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgaWYgKGNvZGUgPT09IHRoaXMuY29kZSkge1xuICAgICAgICB0aGlzLnJldHJ5QXR0ZW1wdHMrKztcbiAgICAgICAgdGhpcy5kZWxheSA9IE1hdGgubWluKHRoaXMuZGVsYXkgKiB0aGlzLmssIHRoaXMubWF4KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZGVsYXkgPSB0aGlzLm1pbjtcbiAgICAgICAgdGhpcy5yZXRyeUF0dGVtcHRzID0gMTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY29kZSA9IGNvZGU7XG4gICAgICBzZXRUaW1lb3V0KFxuICAgICAgICAoKSA9PiByZXNvbHZlKHRoaXMucmV0cnlBdHRlbXB0cyksXG4gICAgICAgIHRoaXMuZGVsYXkgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLm1pbilcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIFJlc2V0IFJldHJ5XG4gICAqL1xuICByZXNldCgpOiB2b2lkIHtcbiAgICB0aGlzLmRlbGF5ID0gdGhpcy5taW47XG4gICAgdGhpcy5yZXRyeUF0dGVtcHRzID0gMTtcbiAgICB0aGlzLmNvZGUgPSAtMTtcbiAgfVxufVxuIl19