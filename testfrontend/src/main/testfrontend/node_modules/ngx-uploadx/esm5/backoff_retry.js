/**
 *  Exponential Backoff Retries
 */
var BackoffRetry = /** @class */ (function () {
    /**
     * @param min  Initial retry delay
     * @param max  Max retry delay
     * @param k    Increase factor
     */
    function BackoffRetry(min, max, k) {
        if (min === void 0) { min = 200; }
        if (max === void 0) { max = min * 300; }
        if (k === void 0) { k = 2; }
        this.min = min;
        this.max = max;
        this.k = k;
        this.code = -1;
        this.retryAttempts = 1;
        this.delay = this.min;
    }
    /**
     * Delay Retry
     * @param code
     * @returns retryAttempts
     */
    BackoffRetry.prototype.wait = function (code) {
        var _this = this;
        return new Promise(function (resolve) {
            if (code === _this.code) {
                _this.retryAttempts++;
                _this.delay = Math.min(_this.delay * _this.k, _this.max);
            }
            else {
                _this.delay = _this.min;
                _this.retryAttempts = 1;
            }
            _this.code = code;
            setTimeout(function () { return resolve(_this.retryAttempts); }, _this.delay + Math.floor(Math.random() * _this.min));
        });
    };
    /**
     * Reset Retry
     */
    BackoffRetry.prototype.reset = function () {
        this.delay = this.min;
        this.retryAttempts = 1;
        this.code = -1;
    };
    return BackoffRetry;
}());
export { BackoffRetry };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja29mZl9yZXRyeS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC11cGxvYWR4LyIsInNvdXJjZXMiOlsiYmFja29mZl9yZXRyeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7R0FFRztBQUNIO0lBSUU7Ozs7T0FJRztJQUNILHNCQUFvQixHQUFTLEVBQVUsR0FBZSxFQUFVLENBQUs7UUFBakQsb0JBQUEsRUFBQSxTQUFTO1FBQVUsb0JBQUEsRUFBQSxNQUFNLEdBQUcsR0FBRyxHQUFHO1FBQVUsa0JBQUEsRUFBQSxLQUFLO1FBQWpELFFBQUcsR0FBSCxHQUFHLENBQU07UUFBVSxRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQVUsTUFBQyxHQUFELENBQUMsQ0FBSTtRQVA3RCxTQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDbEIsa0JBQWEsR0FBRyxDQUFDLENBQUM7UUFPaEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ3hCLENBQUM7SUFDRDs7OztPQUlHO0lBQ0gsMkJBQUksR0FBSixVQUFLLElBQWE7UUFBbEIsaUJBZUM7UUFkQyxPQUFPLElBQUksT0FBTyxDQUFDLFVBQUEsT0FBTztZQUN4QixJQUFJLElBQUksS0FBSyxLQUFJLENBQUMsSUFBSSxFQUFFO2dCQUN0QixLQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQ3JCLEtBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFJLENBQUMsS0FBSyxHQUFHLEtBQUksQ0FBQyxDQUFDLEVBQUUsS0FBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3REO2lCQUFNO2dCQUNMLEtBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSSxDQUFDLEdBQUcsQ0FBQztnQkFDdEIsS0FBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUM7YUFDeEI7WUFDRCxLQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUNqQixVQUFVLENBQ1IsY0FBTSxPQUFBLE9BQU8sQ0FBQyxLQUFJLENBQUMsYUFBYSxDQUFDLEVBQTNCLENBQTJCLEVBQ2pDLEtBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsS0FBSSxDQUFDLEdBQUcsQ0FBQyxDQUNsRCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0Q7O09BRUc7SUFDSCw0QkFBSyxHQUFMO1FBQ0UsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDakIsQ0FBQztJQUNILG1CQUFDO0FBQUQsQ0FBQyxBQXpDRCxJQXlDQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIEV4cG9uZW50aWFsIEJhY2tvZmYgUmV0cmllc1xuICovXG5leHBvcnQgY2xhc3MgQmFja29mZlJldHJ5IHtcbiAgcHJpdmF0ZSBkZWxheTogbnVtYmVyO1xuICBwcml2YXRlIGNvZGUgPSAtMTtcbiAgcmV0cnlBdHRlbXB0cyA9IDE7XG4gIC8qKlxuICAgKiBAcGFyYW0gbWluICBJbml0aWFsIHJldHJ5IGRlbGF5XG4gICAqIEBwYXJhbSBtYXggIE1heCByZXRyeSBkZWxheVxuICAgKiBAcGFyYW0gayAgICBJbmNyZWFzZSBmYWN0b3JcbiAgICovXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbWluID0gMjAwLCBwcml2YXRlIG1heCA9IG1pbiAqIDMwMCwgcHJpdmF0ZSBrID0gMikge1xuICAgIHRoaXMuZGVsYXkgPSB0aGlzLm1pbjtcbiAgfVxuICAvKipcbiAgICogRGVsYXkgUmV0cnlcbiAgICogQHBhcmFtIGNvZGVcbiAgICogQHJldHVybnMgcmV0cnlBdHRlbXB0c1xuICAgKi9cbiAgd2FpdChjb2RlPzogbnVtYmVyKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICBpZiAoY29kZSA9PT0gdGhpcy5jb2RlKSB7XG4gICAgICAgIHRoaXMucmV0cnlBdHRlbXB0cysrO1xuICAgICAgICB0aGlzLmRlbGF5ID0gTWF0aC5taW4odGhpcy5kZWxheSAqIHRoaXMuaywgdGhpcy5tYXgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kZWxheSA9IHRoaXMubWluO1xuICAgICAgICB0aGlzLnJldHJ5QXR0ZW1wdHMgPSAxO1xuICAgICAgfVxuICAgICAgdGhpcy5jb2RlID0gY29kZTtcbiAgICAgIHNldFRpbWVvdXQoXG4gICAgICAgICgpID0+IHJlc29sdmUodGhpcy5yZXRyeUF0dGVtcHRzKSxcbiAgICAgICAgdGhpcy5kZWxheSArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMubWluKVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuICAvKipcbiAgICogUmVzZXQgUmV0cnlcbiAgICovXG4gIHJlc2V0KCk6IHZvaWQge1xuICAgIHRoaXMuZGVsYXkgPSB0aGlzLm1pbjtcbiAgICB0aGlzLnJldHJ5QXR0ZW1wdHMgPSAxO1xuICAgIHRoaXMuY29kZSA9IC0xO1xuICB9XG59XG4iXX0=